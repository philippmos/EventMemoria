@page "/download"

@using EventMemoria.Web.Common.Settings
@using Microsoft.Extensions.Options
@using EventMemoria.Web.Components.Download

@rendermode InteractiveServer

<CustomPageTitle Value="Download" />

<div class="birds-container">
	<HeaderComponent />
	
	<div class="qr-code-container">
		<MudStack Spacing="4" AlignItems="AlignItems.Center">

			<DownloadInfo />

			<ImageQualitySelector @bind-SelectedImageSize="selectedImageSize" />

			<DownloadForm @bind-MobileNumber="mobileNumber"
						  SelectedImageSize="selectedImageSize"
						  @bind-IsLoading="isLoading"
						  StatusMessage="statusMessage"
						  StatusSeverity="statusSeverity"
						  OnDownloadSuccess="HandleDownloadSuccess"
						  OnDownloadError="HandleDownloadError"
						  OnStatusMessageCleared="() => statusMessage = string.Empty" />

		</MudStack>
	</div>
</div>

@code {
	[Inject] private IOptions<CustomizationOptions> CustomizationOptions { get; set; } = null!;

	private bool isLoading;
	private string mobileNumber = string.Empty;
	private string selectedImageSize = "compressed";
	private string statusMessage = string.Empty;
	private Severity statusSeverity = Severity.Info;

	private void HandleDownloadSuccess()
	{
		statusMessage = "Download-Anfrage erfolgreich gesendet! Du erhältst in Kürze eine SMS mit dem Download-Link.";
		statusSeverity = Severity.Success;
		StateHasChanged();
	}

	private void HandleDownloadError()
	{
		statusMessage = "Fehler beim Senden der Anfrage. Bitte versuche es später erneut.";
		statusSeverity = Severity.Error;
		StateHasChanged();
	}
}
