@page "/"

@using EventMemoria.Web.Components.NameModal
@using EventMemoria.Web.Components.Photo

@rendermode InteractiveServer

<CustomPageTitle Value="Galerie" />

<NameModal OnNameSaved="@OnNameSaved" />

<HeaderComponent />

<UploadComponent @ref="_uploadComponent"
                        OnPhotosUploaded="@RefreshVirtualizedGridAsync" />
<VirtualizedGrid @ref="_virtualizedGrid"
                        OnPhotosLoaded="@OnPhotosLoaded" />

@code {

    private VirtualizedGrid? _virtualizedGrid;
    private UploadComponent? _uploadComponent;

    private async Task RefreshVirtualizedGridAsync()
    {
        if (_virtualizedGrid != null)
        {
            await _virtualizedGrid.RefreshPhotosAsync();
        }

        await InvokeAsync(StateHasChanged);
    }

    private void OnPhotosLoaded(List<Photo> photos)
    {
        StateHasChanged();
    }

    private async Task OnNameSaved()
    {
        if (_uploadComponent != null)
        {
            await _uploadComponent.RefreshUserNameAsync();
        }
    }
}
